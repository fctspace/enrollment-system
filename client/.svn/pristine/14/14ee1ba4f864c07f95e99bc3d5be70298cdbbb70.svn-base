//index.js
//获取应用实例
const app = getApp()

Page({
  data: {
    platform: '',
    src: "https://zhaosheng-test.szis.com.cn/#/login",
    // src: "http://d44f2e619130.ngrok.io/#/login",
    // src: "http://100.168.1.2:8080/#/login",
    code: "",
    info: {
      id: ""
    }
  },
  onLoad: function (option) {
    // 扫描小程序码进入
    if (option.scene) {
      let info = decodeURIComponent(option.scene)
      this.setData({
        'info.id': info.id
      })
    }
  },
  //登录
  clickCode (e) {
    console.log(e)
    let _this = this;
    wx.login({
      success(res) {
        if (res.code) {
          //发起网络请求
          let src = "";
          let math = (new Date()).getTime()
            src = `${_this.data.src}?code=${res.code}&recruitSchoolId=${_this.data.info.id}&math=${math}`
          _this.setData({
            code: res.code,
            src: src
          })
          console.log(res.code)
          // wx.navigateTo({
          //   url: '/pages/login/login',
          //   success: function(res) {
          //     // 通过eventChannel向被打开页面传送数据
          //     res.eventChannel.emit('src', { data: src })
          //   }
          // })
        } else {
          console.log('登录失败！' + res.errMsg)
        }
      },
      fail (err) {
        console.log(err)
      }
    })
  },
})